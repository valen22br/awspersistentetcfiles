"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const os = require("os");
const path = require("path");
const util_1 = require("util");
const fs = require("fs-extra");
const migrate_1 = require("../../lib/commands/migrate");
const mock_sdk_1 = require("../util/mock-sdk");
const exec = (0, util_1.promisify)(child_process_1.exec);
describe('Migrate Function Tests', () => {
    let sdkProvider;
    let getTemplateMock;
    let cfnMocks;
    const testResourcePath = [__dirname, 'test-resources'];
    const templatePath = [...testResourcePath, 'templates'];
    const stackPath = [...testResourcePath, 'stacks'];
    const validTemplatePath = path.join(...templatePath, 's3-template.json');
    const validTemplate = (0, migrate_1.readFromPath)(validTemplatePath);
    beforeEach(() => {
        sdkProvider = new mock_sdk_1.MockSdkProvider();
        getTemplateMock = jest.fn();
        cfnMocks = { getTemplate: getTemplateMock };
        sdkProvider.stubCloudFormation(cfnMocks);
    });
    test('validateSourceOptions throws if both --from-path and --from-stack is provided', () => {
        expect(() => (0, migrate_1.validateSourceOptions)('any-value', true)).toThrowError('Only one of `--from-path` or `--from-stack` may be provided.');
    });
    test('validateSourceOptions throws if neither --from-path or --from-stack is provided', () => {
        expect(() => (0, migrate_1.validateSourceOptions)(undefined, undefined)).toThrowError('Either `--from-path` or `--from-stack` must be used to provide the source of the CloudFormation template.');
    });
    test('validateSourceOptions does not throw when only --from-path is supplied', () => {
        expect(() => (0, migrate_1.validateSourceOptions)('any-value', false)).not.toThrow();
    });
    test('validateSourceOptions does now throw when only --from-stack is provided', () => {
        expect(() => (0, migrate_1.validateSourceOptions)(undefined, true)).not.toThrow();
    });
    test('readFromPath produces a string representation of the template at a given path', () => {
        expect((0, migrate_1.readFromPath)(validTemplatePath)).toEqual(fs.readFileSync(validTemplatePath, 'utf8'));
    });
    test('readFromPath returns undefined when template file is not provided', () => {
        expect((0, migrate_1.readFromPath)()).toEqual(undefined);
    });
    test('readFromPath throws error when template file does not exist at a given path', () => {
        const badTemplatePath = './not-here.json';
        expect(() => (0, migrate_1.readFromPath)(badTemplatePath)).toThrowError(`\'${badTemplatePath}\' is not a valid path.`);
    });
    test('readFromStack produces a string representation of the template retrieved from CloudFormation', async () => {
        const template = fs.readFileSync(validTemplatePath);
        getTemplateMock.mockImplementationOnce(() => ({
            TemplateBody: template,
        }));
        expect(await (0, migrate_1.readFromStack)('this-one', sdkProvider, { account: 'num', region: 'here', name: 'hello-my-name-is-what...' })).toEqual(template);
    });
    test('readFromStack throws error when no stack exists with the stack name in the account and region', async () => {
        getTemplateMock.mockImplementationOnce(() => { throw new Error('No stack. This did not go well.'); });
        await expect(() => (0, migrate_1.readFromStack)('that-one', sdkProvider, { account: 'num', region: 'here', name: 'hello-my-name-is-who...' })).rejects.toThrowError('No stack. This did not go well.');
    });
    test('setEnvironment sets account and region when provided', () => {
        expect((0, migrate_1.setEnvironment)('my-account', 'somewhere')).toEqual({ account: 'my-account', region: 'somewhere', name: 'cdk-migrate-env' });
    });
    test('serEnvironment uses default account and region when not provided', () => {
        expect((0, migrate_1.setEnvironment)()).toEqual({ account: 'unknown-account', region: 'unknown-region', name: 'cdk-migrate-env' });
    });
    test('generateStack generates the expected stack string when called for typescript', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodTypeScript', 'typescript');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 's3-stack.ts'), 'utf8'));
    });
    test('generateStack generates the expected stack string when called for python', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodPython', 'python');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 's3_stack.py'), 'utf8'));
    });
    test('generateStack generates the expected stack string when called for java', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodJava', 'java');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.java'), 'utf8'));
    });
    test('generateStack generates the expected stack string when called for csharp', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodCSharp', 'csharp');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.cs'), 'utf8'));
    });
    // TODO: fix with actual go template
    test('generateStack generates the expected stack string when called for go', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodGo', 'go');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 's3.go'), 'utf8'));
    });
    test('generateStack throws error when called for other language', () => {
        expect(() => (0, migrate_1.generateStack)(validTemplate, 'BadBadBad', 'php')).toThrowError('stack generation failed due to error \'unreachable\'');
    });
    cliTest('generateCdkApp generates the expected cdk app when called for typescript', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodTypeScript', 'typescript');
        await (0, migrate_1.generateCdkApp)('GoodTypeScript', stack, 'typescript', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'package.json'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'bin', 'good_type_script.ts'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'lib', 'good_type_script-stack.ts'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodTypeScript', 'bin', 'good_type_script.ts'), 'utf8').split('\n');
        expect(app.map(line => line.match('import { GoodTypeScriptStack } from \'../lib/good_type_script-stack\';')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/new GoodTypeScriptStack\(app, \'GoodTypeScript\', \{/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodTypeScript', 'lib', 'good_type_script-stack.ts'));
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 's3-stack.ts')));
    });
    cliTest('generateCdkApp generates the expected cdk app when called for python', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodPython', 'python');
        await (0, migrate_1.generateCdkApp)('GoodPython', stack, 'python', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodPython', 'requirements.txt'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodPython', 'app.py'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodPython', 'good_python', 'good_python_stack.py'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodPython', 'app.py'), 'utf8').split('\n');
        expect(app.map(line => line.match('from good_python.good_python_stack import GoodPythonStack')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/GoodPythonStack\(app, "GoodPython",/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodPython', 'good_python', 'good_python_stack.py'));
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 's3_stack.py')));
    });
    cliTest('generateCdkApp generates the expected cdk app when called for java', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodJava', 'java');
        await (0, migrate_1.generateCdkApp)('GoodJava', stack, 'java', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodJava', 'pom.xml'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaApp.java'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaStack.java'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaApp.java'), 'utf8').split('\n');
        expect(app.map(line => line.match('public class GoodJavaApp \{')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/        new GoodJavaStack\(app, "GoodJava", StackProps.builder()/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaStack.java'));
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.java')));
    });
    cliTest('generateCdkApp generates the expected cdk app when called for csharp', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodCSharp', 'csharp');
        await (0, migrate_1.generateCdkApp)('GoodCSharp', stack, 'csharp', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp.sln'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'Program.cs'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'GoodCSharpStack.cs'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'Program.cs'), 'utf8').split('\n');
        expect(app.map(line => line.match('namespace GoodCSharp')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/        new GoodCSharpStack\(app, "GoodCSharp", new StackProps/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'GoodCSharpStack.cs'));
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.cs')));
    });
    cliTest('generatedCdkApp generates the expected cdk app when called for go', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodGo', 'go');
        await (0, migrate_1.generateCdkApp)('GoodGo', stack, 'go', workDir);
        expect(fs.pathExists(path.join(workDir, 's3.go'))).toBeTruthy();
        const app = fs.readFileSync(path.join(workDir, 'GoodGo', 'good_go.go'), 'utf8').split('\n');
        expect(app.map(line => line.match(/func NewGoodGoStack\(scope constructs.Construct, id string, props GoodGoStackProps\) \*GoodGoStack \{/)).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/    NewGoodGoStack\(app, "GoodGo", &GoodGoStackProps\{/)));
    });
    cliTest('generatedCdkApp generates a zip file when --compress is used', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodTypeScript', 'typescript');
        await (0, migrate_1.generateCdkApp)('GoodTypeScript', stack, 'typescript', workDir, true);
        // Packages not in outDir
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'package.json'))).toBeFalsy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'bin', 'good_type_script.ts'))).toBeFalsy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'lib', 'good_type_script-stack.ts'))).toBeFalsy();
        // Zip file exists
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript.zip'))).toBeTruthy();
        // Unzip it
        await exec(`unzip ${path.join(workDir, 'GoodTypeScript.zip')}`, { cwd: workDir });
        // Now the files should be there
        expect(fs.pathExistsSync(path.join(workDir, 'package.json'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'bin', 'good_type_script.ts'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'lib', 'good_type_script-stack.ts'))).toBeTruthy();
    });
});
function cliTest(name, handler) {
    test(name, () => withTempDir(handler));
}
async function withTempDir(cb) {
    const tmpDir = await fs.mkdtemp(path.join(os.tmpdir(), 'aws-cdk-test'));
    try {
        await cb(tmpDir);
    }
    finally {
        await fs.remove(tmpDir);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWlncmF0ZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWlncmF0ZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaURBQThDO0FBQzlDLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsK0JBQWlDO0FBQ2pDLCtCQUErQjtBQUMvQix3REFBK0k7QUFDL0ksK0NBQXNGO0FBRXRGLE1BQU0sSUFBSSxHQUFHLElBQUEsZ0JBQVMsRUFBQyxvQkFBSyxDQUFDLENBQUM7QUFFOUIsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtJQUN0QyxJQUFJLFdBQTRCLENBQUM7SUFDakMsSUFBSSxlQUEwQixDQUFDO0lBQy9CLElBQUksUUFBK0QsQ0FBQztJQUVwRSxNQUFNLGdCQUFnQixHQUFHLENBQUMsU0FBUyxFQUFFLGdCQUFnQixDQUFDLENBQUM7SUFDdkQsTUFBTSxZQUFZLEdBQUcsQ0FBQyxHQUFHLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ3hELE1BQU0sU0FBUyxHQUFHLENBQUMsR0FBRyxnQkFBZ0IsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUVsRCxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxZQUFZLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztJQUN6RSxNQUFNLGFBQWEsR0FBRyxJQUFBLHNCQUFZLEVBQUMsaUJBQWlCLENBQUUsQ0FBQztJQUV2RCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsV0FBVyxHQUFHLElBQUksMEJBQWUsRUFBRSxDQUFDO1FBQ3BDLGVBQWUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDNUIsUUFBUSxHQUFHLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxDQUFDO1FBQzVDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxRQUFlLENBQUMsQ0FBQztJQUNsRCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQywrRUFBK0UsRUFBRSxHQUFH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RUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQ2xCO1lBQVM7UUFDUixNQUFNLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDekI7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhlYyBhcyBfZXhlYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgb3MgZnJvbSAnb3MnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMtZXh0cmEnO1xuaW1wb3J0IHsgZ2VuZXJhdGVDZGtBcHAsIGdlbmVyYXRlU3RhY2ssIHJlYWRGcm9tUGF0aCwgcmVhZEZyb21TdGFjaywgc2V0RW52aXJvbm1lbnQsIHZhbGlkYXRlU291cmNlT3B0aW9ucyB9IGZyb20gJy4uLy4uL2xpYi9jb21tYW5kcy9taWdyYXRlJztcbmltcG9ydCB7IE1vY2tTZGtQcm92aWRlciwgTW9ja2VkT2JqZWN0LCBTeW5jSGFuZGxlclN1YnNldE9mIH0gZnJvbSAnLi4vdXRpbC9tb2NrLXNkayc7XG5cbmNvbnN0IGV4ZWMgPSBwcm9taXNpZnkoX2V4ZWMpO1xuXG5kZXNjcmliZSgnTWlncmF0ZSBGdW5jdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IHNka1Byb3ZpZGVyOiBNb2NrU2RrUHJvdmlkZXI7XG4gIGxldCBnZXRUZW1wbGF0ZU1vY2s6IGplc3QuTW9jaztcbiAgbGV0IGNmbk1vY2tzOiBNb2NrZWRPYmplY3Q8U3luY0hhbmRsZXJTdWJzZXRPZjxBV1MuQ2xvdWRGb3JtYXRpb24+PjtcblxuICBjb25zdCB0ZXN0UmVzb3VyY2VQYXRoID0gW19fZGlybmFtZSwgJ3Rlc3QtcmVzb3VyY2VzJ107XG4gIGNvbnN0IHRlbXBsYXRlUGF0aCA9IFsuLi50ZXN0UmVzb3VyY2VQYXRoLCAndGVtcGxhdGVzJ107XG4gIGNvbnN0IHN0YWNrUGF0aCA9IFsuLi50ZXN0UmVzb3VyY2VQYXRoLCAnc3RhY2tzJ107XG5cbiAgY29uc3QgdmFsaWRUZW1wbGF0ZVBhdGggPSBwYXRoLmpvaW4oLi4udGVtcGxhdGVQYXRoLCAnczMtdGVtcGxhdGUuanNvbicpO1xuICBjb25zdCB2YWxpZFRlbXBsYXRlID0gcmVhZEZyb21QYXRoKHZhbGlkVGVtcGxhdGVQYXRoKSE7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgc2RrUHJvdmlkZXIgPSBuZXcgTW9ja1Nka1Byb3ZpZGVyKCk7XG4gICAgZ2V0VGVtcGxhdGVNb2NrID0gamVzdC5mbigpO1xuICAgIGNmbk1vY2tzID0geyBnZXRUZW1wbGF0ZTogZ2V0VGVtcGxhdGVNb2NrIH07XG4gICAgc2RrUHJvdmlkZXIuc3R1YkNsb3VkRm9ybWF0aW9uKGNmbk1vY2tzIGFzIGFueSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3ZhbGlkYXRlU291cmNlT3B0aW9ucyB0aHJvd3MgaWYgYm90aCAtLWZyb20tcGF0aCBhbmQgLS1mcm9tLXN0YWNrIGlzIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVNvdXJjZU9wdGlvbnMoJ2FueS12YWx1ZScsIHRydWUpKS50b1Rocm93RXJyb3IoJ09ubHkgb25lIG9mIGAtLWZyb20tcGF0aGAgb3IgYC0tZnJvbS1zdGFja2AgbWF5IGJlIHByb3ZpZGVkLicpO1xuICB9KTtcblxuICB0ZXN0KCd2YWxpZGF0ZVNvdXJjZU9wdGlvbnMgdGhyb3dzIGlmIG5laXRoZXIgLS1mcm9tLXBhdGggb3IgLS1mcm9tLXN0YWNrIGlzIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVNvdXJjZU9wdGlvbnModW5kZWZpbmVkLCB1bmRlZmluZWQpKS50b1Rocm93RXJyb3IoJ0VpdGhlciBgLS1mcm9tLXBhdGhgIG9yIGAtLWZyb20tc3RhY2tgIG11c3QgYmUgdXNlZCB0byBwcm92aWRlIHRoZSBzb3VyY2Ugb2YgdGhlIENsb3VkRm9ybWF0aW9uIHRlbXBsYXRlLicpO1xuICB9KTtcblxuICB0ZXN0KCd2YWxpZGF0ZVNvdXJjZU9wdGlvbnMgZG9lcyBub3QgdGhyb3cgd2hlbiBvbmx5IC0tZnJvbS1wYXRoIGlzIHN1cHBsaWVkJywgKCkgPT4ge1xuICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0ZVNvdXJjZU9wdGlvbnMoJ2FueS12YWx1ZScsIGZhbHNlKSkubm90LnRvVGhyb3coKTtcbiAgfSk7XG5cbiAgdGVzdCgndmFsaWRhdGVTb3VyY2VPcHRpb25zIGRvZXMgbm93IHRocm93IHdoZW4gb25seSAtLWZyb20tc3RhY2sgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlU291cmNlT3B0aW9ucyh1bmRlZmluZWQsIHRydWUpKS5ub3QudG9UaHJvdygpO1xuICB9KTtcblxuICB0ZXN0KCdyZWFkRnJvbVBhdGggcHJvZHVjZXMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIHRlbXBsYXRlIGF0IGEgZ2l2ZW4gcGF0aCcsICgpID0+IHtcbiAgICBleHBlY3QocmVhZEZyb21QYXRoKHZhbGlkVGVtcGxhdGVQYXRoKSkudG9FcXVhbChmcy5yZWFkRmlsZVN5bmModmFsaWRUZW1wbGF0ZVBhdGgsICd1dGY4JykpO1xuICB9KTtcblxuICB0ZXN0KCdyZWFkRnJvbVBhdGggcmV0dXJucyB1bmRlZmluZWQgd2hlbiB0ZW1wbGF0ZSBmaWxlIGlzIG5vdCBwcm92aWRlZCcsICgpID0+IHtcbiAgICBleHBlY3QocmVhZEZyb21QYXRoKCkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVhZEZyb21QYXRoIHRocm93cyBlcnJvciB3aGVuIHRlbXBsYXRlIGZpbGUgZG9lcyBub3QgZXhpc3QgYXQgYSBnaXZlbiBwYXRoJywgKCkgPT4ge1xuICAgIGNvbnN0IGJhZFRlbXBsYXRlUGF0aCA9ICcuL25vdC1oZXJlLmpzb24nO1xuICAgIGV4cGVjdCgoKSA9PiByZWFkRnJvbVBhdGgoYmFkVGVtcGxhdGVQYXRoKSkudG9UaHJvd0Vycm9yKGBcXCcke2JhZFRlbXBsYXRlUGF0aH1cXCcgaXMgbm90IGEgdmFsaWQgcGF0aC5gKTtcbiAgfSk7XG5cbiAgdGVzdCgncmVhZEZyb21TdGFjayBwcm9kdWNlcyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgdGVtcGxhdGUgcmV0cmlldmVkIGZyb20gQ2xvdWRGb3JtYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdGVtcGxhdGUgPSBmcy5yZWFkRmlsZVN5bmModmFsaWRUZW1wbGF0ZVBhdGgpO1xuICAgIGdldFRlbXBsYXRlTW9jay5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+ICh7XG4gICAgICBUZW1wbGF0ZUJvZHk6IHRlbXBsYXRlLFxuICAgIH0pKTtcblxuICAgIGV4cGVjdChhd2FpdCByZWFkRnJvbVN0YWNrKCd0aGlzLW9uZScsIHNka1Byb3ZpZGVyLCB7IGFjY291bnQ6ICdudW0nLCByZWdpb246ICdoZXJlJywgbmFtZTogJ2hlbGxvLW15LW5hbWUtaXMtd2hhdC4uLicgfSkpLnRvRXF1YWwodGVtcGxhdGUpO1xuICB9KTtcblxuICB0ZXN0KCdyZWFkRnJvbVN0YWNrIHRocm93cyBlcnJvciB3aGVuIG5vIHN0YWNrIGV4aXN0cyB3aXRoIHRoZSBzdGFjayBuYW1lIGluIHRoZSBhY2NvdW50IGFuZCByZWdpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgZ2V0VGVtcGxhdGVNb2NrLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoJ05vIHN0YWNrLiBUaGlzIGRpZCBub3QgZ28gd2VsbC4nKTsgfSk7XG4gICAgYXdhaXQgZXhwZWN0KCgpID0+IHJlYWRGcm9tU3RhY2soJ3RoYXQtb25lJywgc2RrUHJvdmlkZXIsIHsgYWNjb3VudDogJ251bScsIHJlZ2lvbjogJ2hlcmUnLCBuYW1lOiAnaGVsbG8tbXktbmFtZS1pcy13aG8uLi4nIH0pKS5yZWplY3RzLnRvVGhyb3dFcnJvcignTm8gc3RhY2suIFRoaXMgZGlkIG5vdCBnbyB3ZWxsLicpO1xuICB9KTtcblxuICB0ZXN0KCdzZXRFbnZpcm9ubWVudCBzZXRzIGFjY291bnQgYW5kIHJlZ2lvbiB3aGVuIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXRFbnZpcm9ubWVudCgnbXktYWNjb3VudCcsICdzb21ld2hlcmUnKSkudG9FcXVhbCh7IGFjY291bnQ6ICdteS1hY2NvdW50JywgcmVnaW9uOiAnc29tZXdoZXJlJywgbmFtZTogJ2Nkay1taWdyYXRlLWVudicgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3NlckVudmlyb25tZW50IHVzZXMgZGVmYXVsdCBhY2NvdW50IGFuZCByZWdpb24gd2hlbiBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNldEVudmlyb25tZW50KCkpLnRvRXF1YWwoeyBhY2NvdW50OiAndW5rbm93bi1hY2NvdW50JywgcmVnaW9uOiAndW5rbm93bi1yZWdpb24nLCBuYW1lOiAnY2RrLW1pZ3JhdGUtZW52JyB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2VuZXJhdGVTdGFjayBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIHN0YWNrIHN0cmluZyB3aGVuIGNhbGxlZCBmb3IgdHlwZXNjcmlwdCcsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RUeXBlU2NyaXB0JywgJ3R5cGVzY3JpcHQnKTtcbiAgICBleHBlY3Qoc3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdzMy1zdGFjay50cycpLCAndXRmOCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2VuZXJhdGVTdGFjayBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIHN0YWNrIHN0cmluZyB3aGVuIGNhbGxlZCBmb3IgcHl0aG9uJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZFB5dGhvbicsICdweXRob24nKTtcbiAgICBleHBlY3Qoc3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdzM19zdGFjay5weScpLCAndXRmOCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2VuZXJhdGVTdGFjayBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIHN0YWNrIHN0cmluZyB3aGVuIGNhbGxlZCBmb3IgamF2YScsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RKYXZhJywgJ2phdmEnKTtcbiAgICBleHBlY3Qoc3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdTM1N0YWNrLmphdmEnKSwgJ3V0ZjgnKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dlbmVyYXRlU3RhY2sgZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBzdGFjayBzdHJpbmcgd2hlbiBjYWxsZWQgZm9yIGNzaGFycCcsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RDU2hhcnAnLCAnY3NoYXJwJyk7XG4gICAgZXhwZWN0KHN0YWNrKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oLi4uc3RhY2tQYXRoLCAnUzNTdGFjay5jcycpLCAndXRmOCcpKTtcbiAgfSk7XG5cbiAgLy8gVE9ETzogZml4IHdpdGggYWN0dWFsIGdvIHRlbXBsYXRlXG4gIHRlc3QoJ2dlbmVyYXRlU3RhY2sgZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBzdGFjayBzdHJpbmcgd2hlbiBjYWxsZWQgZm9yIGdvJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZEdvJywgJ2dvJyk7XG4gICAgZXhwZWN0KHN0YWNrKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oLi4uc3RhY2tQYXRoLCAnczMuZ28nKSwgJ3V0ZjgnKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dlbmVyYXRlU3RhY2sgdGhyb3dzIGVycm9yIHdoZW4gY2FsbGVkIGZvciBvdGhlciBsYW5ndWFnZScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnQmFkQmFkQmFkJywgJ3BocCcpKS50b1Rocm93RXJyb3IoJ3N0YWNrIGdlbmVyYXRpb24gZmFpbGVkIGR1ZSB0byBlcnJvciBcXCd1bnJlYWNoYWJsZVxcJycpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZUNka0FwcCBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIGNkayBhcHAgd2hlbiBjYWxsZWQgZm9yIHR5cGVzY3JpcHQnLCBhc3luYyAod29ya0RpcikgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZFR5cGVTY3JpcHQnLCAndHlwZXNjcmlwdCcpO1xuICAgIGF3YWl0IGdlbmVyYXRlQ2RrQXBwKCdHb29kVHlwZVNjcmlwdCcsIHN0YWNrLCAndHlwZXNjcmlwdCcsIHdvcmtEaXIpO1xuXG4gICAgLy8gUGFja2FnZXMgZXhpc3QgaW4gdGhlIGNvcnJlY3Qgc3BvdFxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ3BhY2thZ2UuanNvbicpKSkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ2JpbicsICdnb29kX3R5cGVfc2NyaXB0LnRzJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQnLCAnbGliJywgJ2dvb2RfdHlwZV9zY3JpcHQtc3RhY2sudHMnKSkpLnRvQmVUcnV0aHkoKTtcblxuICAgIC8vIFJlcGxhY2VkIHN0YWNrIGZpbGUgaXMgcmVmZXJlbmNlZCBjb3JyZWN0bHkgaW4gYXBwIGZpbGVcbiAgICBjb25zdCBhcHAgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kVHlwZVNjcmlwdCcsICdiaW4nLCAnZ29vZF90eXBlX3NjcmlwdC50cycpLCAndXRmOCcpLnNwbGl0KCdcXG4nKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goJ2ltcG9ydCB7IEdvb2RUeXBlU2NyaXB0U3RhY2sgfSBmcm9tIFxcJy4uL2xpYi9nb29kX3R5cGVfc2NyaXB0LXN0YWNrXFwnOycpKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG4gICAgZXhwZWN0KGFwcC5tYXAobGluZSA9PiBsaW5lLm1hdGNoKC9uZXcgR29vZFR5cGVTY3JpcHRTdGFja1xcKGFwcCwgXFwnR29vZFR5cGVTY3JpcHRcXCcsIFxcey8pKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG5cbiAgICAvLyBSZXBsYWNlZCBzdGFjayBmaWxlIGlzIGNvcnJlY3RseSBnZW5lcmF0ZWRcbiAgICBjb25zdCByZXBsYWNlZFN0YWNrID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQnLCAnbGliJywgJ2dvb2RfdHlwZV9zY3JpcHQtc3RhY2sudHMnKSk7XG4gICAgZXhwZWN0KHJlcGxhY2VkU3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdzMy1zdGFjay50cycpKSk7XG4gIH0pO1xuXG4gIGNsaVRlc3QoJ2dlbmVyYXRlQ2RrQXBwIGdlbmVyYXRlcyB0aGUgZXhwZWN0ZWQgY2RrIGFwcCB3aGVuIGNhbGxlZCBmb3IgcHl0aG9uJywgYXN5bmMgKHdvcmtEaXIpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RQeXRob24nLCAncHl0aG9uJyk7XG4gICAgYXdhaXQgZ2VuZXJhdGVDZGtBcHAoJ0dvb2RQeXRob24nLCBzdGFjaywgJ3B5dGhvbicsIHdvcmtEaXIpO1xuXG4gICAgLy8gUGFja2FnZXMgZXhpc3QgaW4gdGhlIGNvcnJlY3Qgc3BvdFxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RQeXRob24nLCAncmVxdWlyZW1lbnRzLnR4dCcpKSkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RQeXRob24nLCAnYXBwLnB5JykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFB5dGhvbicsICdnb29kX3B5dGhvbicsICdnb29kX3B5dGhvbl9zdGFjay5weScpKSkudG9CZVRydXRoeSgpO1xuXG4gICAgLy8gUmVwbGFjZWQgc3RhY2sgZmlsZSBpcyByZWZlcmVuY2VkIGNvcnJlY3RseSBpbiBhcHAgZmlsZVxuICAgIGNvbnN0IGFwcCA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RQeXRob24nLCAnYXBwLnB5JyksICd1dGY4Jykuc3BsaXQoJ1xcbicpO1xuICAgIGV4cGVjdChhcHAubWFwKGxpbmUgPT4gbGluZS5tYXRjaCgnZnJvbSBnb29kX3B5dGhvbi5nb29kX3B5dGhvbl9zdGFjayBpbXBvcnQgR29vZFB5dGhvblN0YWNrJykpLmZpbHRlcihsaW5lID0+IGxpbmUpLmxlbmd0aCkudG9FcXVhbCgxKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goL0dvb2RQeXRob25TdGFja1xcKGFwcCwgXCJHb29kUHl0aG9uXCIsLykpLmZpbHRlcihsaW5lID0+IGxpbmUpLmxlbmd0aCkudG9FcXVhbCgxKTtcblxuICAgIC8vIFJlcGxhY2VkIHN0YWNrIGZpbGUgaXMgY29ycmVjdGx5IGdlbmVyYXRlZFxuICAgIGNvbnN0IHJlcGxhY2VkU3RhY2sgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kUHl0aG9uJywgJ2dvb2RfcHl0aG9uJywgJ2dvb2RfcHl0aG9uX3N0YWNrLnB5JykpO1xuICAgIGV4cGVjdChyZXBsYWNlZFN0YWNrKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oLi4uc3RhY2tQYXRoLCAnczNfc3RhY2sucHknKSkpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZUNka0FwcCBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIGNkayBhcHAgd2hlbiBjYWxsZWQgZm9yIGphdmEnLCBhc3luYyAod29ya0RpcikgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZEphdmEnLCAnamF2YScpO1xuICAgIGF3YWl0IGdlbmVyYXRlQ2RrQXBwKCdHb29kSmF2YScsIHN0YWNrLCAnamF2YScsIHdvcmtEaXIpO1xuXG4gICAgLy8gUGFja2FnZXMgZXhpc3QgaW4gdGhlIGNvcnJlY3Qgc3BvdFxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RKYXZhJywgJ3BvbS54bWwnKSkpLnRvQmVUcnV0aHkoKTtcbiAgICBleHBlY3QoZnMucGF0aEV4aXN0c1N5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kSmF2YScsICdzcmMnLCAnbWFpbicsICdqYXZhJywgJ2NvbScsICdteW9yZycsICdHb29kSmF2YUFwcC5qYXZhJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZEphdmEnLCAnc3JjJywgJ21haW4nLCAnamF2YScsICdjb20nLCAnbXlvcmcnLCAnR29vZEphdmFTdGFjay5qYXZhJykpKS50b0JlVHJ1dGh5KCk7XG5cbiAgICAvLyBSZXBsYWNlZCBzdGFjayBmaWxlIGlzIHJlZmVyZW5jZWQgY29ycmVjdGx5IGluIGFwcCBmaWxlXG4gICAgY29uc3QgYXBwID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZEphdmEnLCAnc3JjJywgJ21haW4nLCAnamF2YScsICdjb20nLCAnbXlvcmcnLCAnR29vZEphdmFBcHAuamF2YScpLCAndXRmOCcpLnNwbGl0KCdcXG4nKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goJ3B1YmxpYyBjbGFzcyBHb29kSmF2YUFwcCBcXHsnKSkuZmlsdGVyKGxpbmUgPT4gbGluZSkubGVuZ3RoKS50b0VxdWFsKDEpO1xuICAgIGV4cGVjdChhcHAubWFwKGxpbmUgPT4gbGluZS5tYXRjaCgvICAgICAgICBuZXcgR29vZEphdmFTdGFja1xcKGFwcCwgXCJHb29kSmF2YVwiLCBTdGFja1Byb3BzLmJ1aWxkZXIoKS8pKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG5cbiAgICAvLyBSZXBsYWNlZCBzdGFjayBmaWxlIGlzIGNvcnJlY3RseSBnZW5lcmF0ZWRcbiAgICBjb25zdCByZXBsYWNlZFN0YWNrID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZEphdmEnLCAnc3JjJywgJ21haW4nLCAnamF2YScsICdjb20nLCAnbXlvcmcnLCAnR29vZEphdmFTdGFjay5qYXZhJykpO1xuICAgIGV4cGVjdChyZXBsYWNlZFN0YWNrKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oLi4uc3RhY2tQYXRoLCAnUzNTdGFjay5qYXZhJykpKTtcbiAgfSk7XG5cbiAgY2xpVGVzdCgnZ2VuZXJhdGVDZGtBcHAgZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBjZGsgYXBwIHdoZW4gY2FsbGVkIGZvciBjc2hhcnAnLCBhc3luYyAod29ya0RpcikgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZENTaGFycCcsICdjc2hhcnAnKTtcbiAgICBhd2FpdCBnZW5lcmF0ZUNka0FwcCgnR29vZENTaGFycCcsIHN0YWNrLCAnY3NoYXJwJywgd29ya0Rpcik7XG5cbiAgICAvLyBQYWNrYWdlcyBleGlzdCBpbiB0aGUgY29ycmVjdCBzcG90XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZENTaGFycCcsICdzcmMnLCAnR29vZENTaGFycC5zbG4nKSkpLnRvQmVUcnV0aHkoKTtcbiAgICBleHBlY3QoZnMucGF0aEV4aXN0c1N5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kQ1NoYXJwJywgJ3NyYycsICdHb29kQ1NoYXJwJywgJ1Byb2dyYW0uY3MnKSkpLnRvQmVUcnV0aHkoKTtcbiAgICBleHBlY3QoZnMucGF0aEV4aXN0c1N5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kQ1NoYXJwJywgJ3NyYycsICdHb29kQ1NoYXJwJywgJ0dvb2RDU2hhcnBTdGFjay5jcycpKSkudG9CZVRydXRoeSgpO1xuXG4gICAgLy8gUmVwbGFjZWQgc3RhY2sgZmlsZSBpcyByZWZlcmVuY2VkIGNvcnJlY3RseSBpbiBhcHAgZmlsZVxuICAgIGNvbnN0IGFwcCA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RDU2hhcnAnLCAnc3JjJywgJ0dvb2RDU2hhcnAnLCAnUHJvZ3JhbS5jcycpLCAndXRmOCcpLnNwbGl0KCdcXG4nKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goJ25hbWVzcGFjZSBHb29kQ1NoYXJwJykpLmZpbHRlcihsaW5lID0+IGxpbmUpLmxlbmd0aCkudG9FcXVhbCgxKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goLyAgICAgICAgbmV3IEdvb2RDU2hhcnBTdGFja1xcKGFwcCwgXCJHb29kQ1NoYXJwXCIsIG5ldyBTdGFja1Byb3BzLykpLmZpbHRlcihsaW5lID0+IGxpbmUpLmxlbmd0aCkudG9FcXVhbCgxKTtcblxuICAgIC8vIFJlcGxhY2VkIHN0YWNrIGZpbGUgaXMgY29ycmVjdGx5IGdlbmVyYXRlZFxuICAgIGNvbnN0IHJlcGxhY2VkU3RhY2sgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kQ1NoYXJwJywgJ3NyYycsICdHb29kQ1NoYXJwJywgJ0dvb2RDU2hhcnBTdGFjay5jcycpKTtcbiAgICBleHBlY3QocmVwbGFjZWRTdGFjaykudG9FcXVhbChmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKC4uLnN0YWNrUGF0aCwgJ1MzU3RhY2suY3MnKSkpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZWRDZGtBcHAgZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBjZGsgYXBwIHdoZW4gY2FsbGVkIGZvciBnbycsIGFzeW5jICh3b3JrRGlyKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSBnZW5lcmF0ZVN0YWNrKHZhbGlkVGVtcGxhdGUsICdHb29kR28nLCAnZ28nKTtcbiAgICBhd2FpdCBnZW5lcmF0ZUNka0FwcCgnR29vZEdvJywgc3RhY2ssICdnbycsIHdvcmtEaXIpO1xuXG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHMocGF0aC5qb2luKHdvcmtEaXIsICdzMy5nbycpKSkudG9CZVRydXRoeSgpO1xuICAgIGNvbnN0IGFwcCA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RHbycsICdnb29kX2dvLmdvJyksICd1dGY4Jykuc3BsaXQoJ1xcbicpO1xuICAgIGV4cGVjdChhcHAubWFwKGxpbmUgPT4gbGluZS5tYXRjaCgvZnVuYyBOZXdHb29kR29TdGFja1xcKHNjb3BlIGNvbnN0cnVjdHMuQ29uc3RydWN0LCBpZCBzdHJpbmcsIHByb3BzIEdvb2RHb1N0YWNrUHJvcHNcXCkgXFwqR29vZEdvU3RhY2sgXFx7LykpLmZpbHRlcihsaW5lID0+IGxpbmUpLmxlbmd0aCkudG9FcXVhbCgxKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goLyAgICBOZXdHb29kR29TdGFja1xcKGFwcCwgXCJHb29kR29cIiwgJkdvb2RHb1N0YWNrUHJvcHNcXHsvKSkpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZWRDZGtBcHAgZ2VuZXJhdGVzIGEgemlwIGZpbGUgd2hlbiAtLWNvbXByZXNzIGlzIHVzZWQnLCBhc3luYyAod29ya0RpcikgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZFR5cGVTY3JpcHQnLCAndHlwZXNjcmlwdCcpO1xuICAgIGF3YWl0IGdlbmVyYXRlQ2RrQXBwKCdHb29kVHlwZVNjcmlwdCcsIHN0YWNrLCAndHlwZXNjcmlwdCcsIHdvcmtEaXIsIHRydWUpO1xuXG4gICAgLy8gUGFja2FnZXMgbm90IGluIG91dERpclxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ3BhY2thZ2UuanNvbicpKSkudG9CZUZhbHN5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQnLCAnYmluJywgJ2dvb2RfdHlwZV9zY3JpcHQudHMnKSkpLnRvQmVGYWxzeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ2xpYicsICdnb29kX3R5cGVfc2NyaXB0LXN0YWNrLnRzJykpKS50b0JlRmFsc3koKTtcblxuICAgIC8vIFppcCBmaWxlIGV4aXN0c1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0LnppcCcpKSkudG9CZVRydXRoeSgpO1xuXG4gICAgLy8gVW56aXAgaXRcbiAgICBhd2FpdCBleGVjKGB1bnppcCAke3BhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQuemlwJyl9YCwgeyBjd2Q6IHdvcmtEaXIgfSk7XG5cbiAgICAvLyBOb3cgdGhlIGZpbGVzIHNob3VsZCBiZSB0aGVyZVxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ3BhY2thZ2UuanNvbicpKSkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ2JpbicsICdnb29kX3R5cGVfc2NyaXB0LnRzJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnbGliJywgJ2dvb2RfdHlwZV9zY3JpcHQtc3RhY2sudHMnKSkpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG59KTtcblxuZnVuY3Rpb24gY2xpVGVzdChuYW1lOiBzdHJpbmcsIGhhbmRsZXI6IChkaXI6IHN0cmluZykgPT4gdm9pZCB8IFByb21pc2U8YW55Pik6IHZvaWQge1xuICB0ZXN0KG5hbWUsICgpID0+IHdpdGhUZW1wRGlyKGhhbmRsZXIpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2l0aFRlbXBEaXIoY2I6IChkaXI6IHN0cmluZykgPT4gdm9pZCB8IFByb21pc2U8YW55Pikge1xuICBjb25zdCB0bXBEaXIgPSBhd2FpdCBmcy5ta2R0ZW1wKHBhdGguam9pbihvcy50bXBkaXIoKSwgJ2F3cy1jZGstdGVzdCcpKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBjYih0bXBEaXIpO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGZzLnJlbW92ZSh0bXBEaXIpO1xuICB9XG59Il19